exposure_sCD40_QC_harmonised$A1_spare <- exposure_sCD40_QC_harmonised$A1
exposure_sCD40_QC_harmonised[exposure_sCD40_QC_harmonised$id %in% flipped_rsids_sCD40, "A1"] <- exposure_sCD40_QC_harmonised$A2[exposure_sCD40_QC$id %in% flipped_rsids_sCD40]
exposure_sCD40_QC_harmonised[exposure_sCD40_QC_harmonised$id %in% flipped_rsids_sCD40, "A2"] <- exposure_sCD40_QC_harmonised$A1_spare[exposure_sCD40_QC$id %in% flipped_rsids_sCD40]
## Remove ambiguous SNPs
ambiguous_SNPs <- exposure_sCD40_QC_harmonised$id[exposure_sCD40_QC_harmonised$A1 == "T" & exposure_sCD40_QC_harmonised$A2 == "A"]
ambiguous_SNPs <- c(ambiguous_SNPs, exposure_sCD40_QC_harmonised$id[exposure_sCD40_QC_harmonised$A1 == "A" & exposure_sCD40_QC_harmonised$A2 == "T"])
ambiguous_SNPs <- c(ambiguous_SNPs, exposure_sCD40_QC_harmonised$id[exposure_sCD40_QC_harmonised$A1 == "C" & exposure_sCD40_QC_harmonised$A2 == "G"])
ambiguous_SNPs <- c(ambiguous_SNPs, exposure_sCD40_QC_harmonised$id[exposure_sCD40_QC_harmonised$A1 == "G" & exposure_sCD40_QC_harmonised$A2 == "C"])
test <- exposure_sCD40_QC_harmonised[,!exposure_sCD40_QC_harmonised$id %in% ambiguous_SNPs]
!exposure_sCD40_QC_harmonised$id %in% ambiguous_SNPs
exposure_sCD40_QC_harmonised
test <- exposure_sCD40_QC_harmonised[,!exposure_sCD40_QC_harmonised$id %in% ambiguous_SNPs]
exposure_sCD40_QC_harmonised[,(!exposure_sCD40_QC_harmonised$id %in% ambiguous_SNPs)]
exposure_sCD40_QC_harmonised[(!exposure_sCD40_QC_harmonised$id %in% ambiguous_SNPs)]
test <- exposure_sCD40_QC_harmonised[(!exposure_sCD40_QC_harmonised$id %in% ambiguous_SNPs)]
exposure_sCD40_QC_harmonised[(!exposure_sCD40_QC_harmonised$id %in% ambiguous_SNPs)]
ambiguous_SNPs
exposure_sCD40_QC_harmonised$id %in% ambiguous_SNPs
sum(exposure_sCD40_QC_harmonised$id %in% ambiguous_SNPs)
exposure_sCD40_QC_harmonised_no_ambiguous <- exposure_sCD40_QC_harmonised[(!exposure_sCD40_QC_harmonised$id %in% ambiguous_SNPs)]
nrow(exposure_sCD40_QC_harmonised_no_ambiguous) - nrow(exposure_sCD40_QC_harmonised)
write.table(exposure_sCD40_QC_harmonised_no_ambiguous, '~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/sCD40_harmonised.tsv', sep = '\t', row.names = F, quote = F)
source("~/Desktop/PhD/projects/CP_MDD_inflammation_MR/bin/colocalisation/3_harmonise_GWAS_1000g.R")
library(coloc)
library(dplyr)
#install.packages("devtools")
library(devtools)
#install_github("jrs95/gassocplot")
library(gassocplot)
#install.packages("LDlinkR")
library(LDlinkR)
library(ieugwasr)
#install.packages("Rfast")
library(Rfast)
library(patchwork)
library(ggplot2)
#install.packages("susieR")
library(susieR)
set.seed(151097)
library(LDlinkR)
library(ggplotify)
## Read in harmonized summary statistics - limited to 500kb +/- CD40 transcipt region
MCP <- read.table('~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/MCP_harmonised.tsv', header = T)
MDD <- read.table('~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/MDD_harmonised.tsv', header = T)
CD40 <- read.table('~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/sCD40_harmonised.tsv', header = T)
## Get LD matrices for each GWAS
LD_MCP <- LD_no_dup[MCP$id,MCP$id]
LD_MDD <- LD_no_dup[MDD$id,MDD$id]
LD_CD40 <- LD_no_dup[CD40$id,CD40$id]
## Plot CD40 region
CD40_small <- CD40[CD40$id %in% colnames(LD_CD40),]
## Load LD matrix and SNP list
LD <- read.table('/Users/hannahcasey/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/LD_matrix.ld')
LD_snps <- read.table('~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/LD_matrix.snplist')
## Find duplicates in SNP list
LD_no_dup <- LD[-which(duplicated(LD_snps$V1)), -which(duplicated(LD_snps$V1))]
LD_snps_no_dup <- LD_snps$V1[-which(duplicated(LD_snps$V1))]
colnames(LD_no_dup) <- LD_snps_no_dup
rownames(LD_no_dup) <- LD_snps_no_dup
## Replace NaN values with 0
LD_no_dup[is.nan(as.matrix(LD_no_dup))] <- 0
## Remove SNPs with no LD info from LD matrix and GWAS sumstats
LD_no_dup <- LD_no_dup[!names(LD_no_dup) %in% LD_no_info, !names(LD_no_dup) %in% LD_no_info]
## Remove SNPs with no LD info from LD matrix and GWAS sumstats
MCP <- MCP[!MCP$id %in% LD_no_info,]
MDD <- MDD[!MDD$id %in% LD_no_info,]
## Get LD matrices for each GWAS
LD_MCP <- LD_no_dup[MCP$id,MCP$id]
LD_MDD <- LD_no_dup[MDD$id,MDD$id]
LD_CD40 <- LD_no_dup[CD40$id,CD40$id]
## Plot CD40 region
CD40_small <- CD40[CD40$id %in% colnames(LD_CD40),]
CD40_small_plot <-  CD40_small %>% dplyr::select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)
assoc_plot(CD40_small_plot, corr = LD_CD40)
MDD_small <- MDD[MDD$id %in% colnames(LD_MDD),]
assoc_plot((MDD_small %>% select(id, chr, pos, zscore) %>% rename(marker = id, z = zscore)), corr = LD_MDD)
MCP_small <- MCP[MCP$id %in% colnames(LD_MCP),]
assoc_plot((MCP_small %>% select(id, chr, pos, zscore) %>% rename(marker = id, z = zscore)), corr = LD_MCP)
## get MAF
CD40_small$MAF <- as.numeric(CD40_small$freq)
MDD_small$MAF <- as.numeric(MDD_small$freq)
MCP_small$MAF <- as.numeric(MCP_small$freq)
## remove rows with NA
CD40_small <- na.omit(CD40_small)
MDD_small <- na.omit(MDD_small)
MCP_small <- na.omit(MCP_small)
## make list
exposure_list <- list("pvalues" = CD40_small$pvalue, "beta" = CD40_small$beta, "varbeta" = CD40_small$varbeta, "N" = CD40_small$n, "type" = "quant", "MAF" = CD40_small$MAF, "LD" = as.matrix(LD_CD40), "snp" = CD40_small$id, "position" = CD40_small$pos)
outcome_MDD_list <- list("pvalues" = MDD_small$pvalue, "beta" = MDD_small$beta, "varbeta" = MDD_small$varbeta, "N" = MDD_small$n, "type" = "cc", "s" = mean(MDD_small$s), "MAF" = MDD_small$MAF, "LD" = as.matrix(LD_MDD), "snp" = MDD_small$id, "position" = MDD_small$pos, "sdY" = 1)
outcome_MCP_list <- list("pvalues" = MCP_small$pvalue, "beta" = MCP_small$beta, "varbeta" = MCP_small$varbeta, "N" = 440780, "type" = "quant", "MAF" = MCP_small$MAF, "LD" = as.matrix(LD_MCP), "snp" = MCP_small$id, "position" = MCP_small$pos)
check_alignment(exposure_list)
check_alignment(outcome_MDD_list)
check_alignment(outcome_MCP_list)
str(exposure_list)
str(outcome_MDD_list)
str(outcome_MCP_list)
plot_dataset(exposure_list)
plot_dataset(outcome_MDD_list)
plot_dataset(outcome_MCP_list)
## standard coloc (single causal variant)
my.res <- coloc.abf(dataset1=exposure_list, dataset2=outcome_MDD_list)
## standard coloc (single causal variant)
my.res <- coloc.abf(dataset1=exposure_list, dataset2=outcome_MDD_list)
## standard coloc (single causal variant)
my.res <- coloc.abf(dataset1=exposure_list, dataset2=outcome_MDD_list)
sensitivity(my.res,"H4 > 0.9")
my.res <- coloc.abf(dataset1=exposure_list, dataset2=outcome_MCP_list)
sensitivity(my.res,"H4 > 0.9")
## finemap
finemap.signals(exposure_list,method="cond")
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs4810485")
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs149089718")
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs148236506")
View(CD40_small)
S_exposure_list <- runsusie(exposure_list, n = 21758, max_iter = 10000)
summary(S_exposure_list)
## Save susie output
save(S_outcome_MDD_list, file = "~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/S_outcome_MDD_list.Rdata")
save(S_outcome_MCP_list, file = "~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/S_outcome_MCP_list.Rdata")
save(S_exposure_list,file = "~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/S_exposure_list.Rdata")
View(S_exposure_list)
CD40_small_plot <-  CD40_small %>% dplyr::select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)
assoc_plot(CD40_small_plot, corr = LD_CD40)
source("~/Desktop/PhD/projects/CP_MDD_inflammation_MR/bin/colocalisation/3_harmonise_GWAS_1000g.R")
CD40_small$MAF <- as.numeric(CD40_small$freq)
CD40_small$MAF <- ifelse(CD40_small$freq > 0.5, 1-CD40_small$freq, CD40_small$freq)
MDD_small$MAF <- as.numeric(MDD_small$freq)
MDD_small$MAF <- ifelse(MDD_small$freq > 0.5, 1-MDD_small$freq, MDD_small$freq)
MCP_small$MAF <- as.numeric(MCP_small$freq)
MCP_small$MAF <- ifelse(MCP_small$freq > 0.5, 1-MCP_small$freq, MCP_small$freq)
## remove rows with NA
CD40_small <- na.omit(CD40_small)
MDD_small <- na.omit(MDD_small)
MCP_small <- na.omit(MCP_small)
## make list
exposure_list <- list("pvalues" = CD40_small$pvalue, "beta" = CD40_small$beta, "varbeta" = CD40_small$varbeta, "N" = CD40_small$n, "type" = "quant", "MAF" = CD40_small$MAF, "LD" = as.matrix(LD_CD40), "snp" = CD40_small$id, "position" = CD40_small$pos)
outcome_MDD_list <- list("pvalues" = MDD_small$pvalue, "beta" = MDD_small$beta, "varbeta" = MDD_small$varbeta, "N" = MDD_small$n, "type" = "cc", "s" = mean(MDD_small$s), "MAF" = MDD_small$MAF, "LD" = as.matrix(LD_MDD), "snp" = MDD_small$id, "position" = MDD_small$pos, "sdY" = 1)
outcome_MCP_list <- list("pvalues" = MCP_small$pvalue, "beta" = MCP_small$beta, "varbeta" = MCP_small$varbeta, "N" = 440780, "type" = "quant", "MAF" = MCP_small$MAF, "LD" = as.matrix(LD_MCP), "snp" = MCP_small$id, "position" = MCP_small$pos)
check_alignment(exposure_list)
check_alignment(outcome_MDD_list)
check_alignment(outcome_MCP_list)
str(exposure_list)
str(outcome_MDD_list)
str(outcome_MCP_list)
plot_dataset(exposure_list)
plot_dataset(outcome_MDD_list)
plot_dataset(outcome_MCP_list)
## standard coloc (single causal variant)
my.res <- coloc.abf(dataset1=exposure_list, dataset2=outcome_MDD_list)
sensitivity(my.res,"H4 > 0.9")
my.res <- coloc.abf(dataset1=exposure_list, dataset2=outcome_MCP_list)
sensitivity(my.res,"H4 > 0.9")
## finemap
finemap.signals(exposure_list,method="cond")
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs149089718")
exposure_list
View(exposure_list)
View(LD)
View(exposure_sCD40_QC_harmonised)
View(exposure_sCD40_QC_harmonised_no_ambiguous)
## finemap
finemap.signals(exposure_list,method="cond")
## Load LD matrix and SNP list
LD <- read.table('/Users/hannahcasey/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/LD_matrix_spaces.ld')
source("~/Desktop/PhD/projects/CP_MDD_inflammation_MR/bin/colocalisation/3_harmonise_GWAS_1000g.R")
which(exposure_list$snp == "rs149089718")
exposure_list$pvalues[which(exposure_list$snp == "rs149089718")]
exposure_list$pvalues[which(exposure_list$snp == "rs148236506")]
exposure_list$LD[which(exposure_list$snp == "rs148236506")]
exposure_list$LD
colnames(LD_CD40)
colnames(LD_CD40)[1:10]
CD40_small$id[1:10]
colnames(LD_CD40)[450]
CD40_small$id[450]
check_alignment(exposure_list)
check_alignment(outcome_MDD_list)
check_alignment(outcome_MCP_list)
data("N3finemapping")
n = nrow(N3finemapping$X)
b = N3finemapping$true_coef[,1]
sumstats <- univariate_regression(N3finemapping$X, N3finemapping$Y[,1])
z_scores <- sumstats$betahat / sumstats$sebetahat
Rin = cor(N3finemapping$X)
attr(Rin, "eigen") = eigen(Rin, symmetric = TRUE)
susie_plot(z_scores, y = "z", b=b)
library(coloc)
library(dplyr)
#install.packages("devtools")
library(devtools)
#install_github("jrs95/gassocplot")
library(gassocplot)
#install.packages("LDlinkR")
library(LDlinkR)
library(ieugwasr)
#install.packages("Rfast")
library(Rfast)
library(patchwork)
library(ggplot2)
#install.packages("susieR")
library(susieR)
set.seed(151097)
library(LDlinkR)
library(ggplotify)
## Read in harmonized summary statistics - limited to 500kb +/- CD40 transcipt region
MCP <- read.table('~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/MCP_harmonised.tsv', header = T)
MDD <- read.table('~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/MDD_harmonised.tsv', header = T)
CD40 <- read.table('~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/sCD40_harmonised.tsv', header = T)
## Load LD matrix and SNP list
LD <- read.table('/Users/hannahcasey/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/LD_matrix.ld')
LD_snps <- read.table('~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/LD_matrix.snplist')
## Find duplicates in SNP list
LD_no_dup <- LD[-which(duplicated(LD_snps$V1)), -which(duplicated(LD_snps$V1))]
LD_snps_no_dup <- LD_snps$V1[-which(duplicated(LD_snps$V1))]
colnames(LD_no_dup) <- LD_snps_no_dup
rownames(LD_no_dup) <- LD_snps_no_dup
## Remove rows with all NaN values from LD matrix
LD_no_dup <- LD_no_dup[-which(is.nan(as.matrix(LD_no_dup$rs143028411))), -which(is.nan(as.matrix(LD_no_dup$rs143028411)))]
# ## Remove SNPs with no LD info from GWAS sumstats
MCP <- MCP[MCP$id %in% LD_snps_no_dup,]
MDD <- MDD[MDD$id %in% LD_snps_no_dup,]
CD40 <- CD40[CD40$id %in% LD_snps_no_dup,]
## Get LD matrices for each GWAS
LD_MCP <- LD_no_dup[MCP$id,MCP$id]
## Find duplicates in SNP list
LD_no_dup <- LD[-which(duplicated(LD_snps$V1)), -which(duplicated(LD_snps$V1))]
LD_snps_no_dup <- LD_snps$V1[-which(duplicated(LD_snps$V1))]
colnames(LD_no_dup) <- LD_snps_no_dup
rownames(LD_no_dup) <- LD_snps_no_dup
## Remove rows with all NaN values from LD matrix
LD_no_dup <- LD_no_dup[-which(is.nan(as.matrix(LD_no_dup$rs143028411))), -which(is.nan(as.matrix(LD_no_dup$rs143028411)))]
# ## Remove SNPs with no LD info from GWAS sumstats
MCP <- MCP[MCP$id %in% LD_snps_no_dup,]
MDD <- MDD[MDD$id %in% LD_snps_no_dup,]
CD40 <- CD40[CD40$id %in% LD_snps_no_dup,]
## Get LD matrices for each GWAS
LD_MCP <- LD_no_dup[MCP$id,MCP$id]
MCP$id
## Get LD matrices for each GWAS
LD_MCP <- LD_no_dup[MCP$id[MCP$id %in% colnames(LD_no_dup)], MCP$id[MCP$id %in% colnames(LD_no_dup)]]
LD_MDD <- LD_no_dup[MDD$id[MDD$id %in% colnames(LD_no_dup)], MDD$id[MDD$id %in% colnames(LD_no_dup)]]
LD_CD40 <- LD_no_dup[CD40$id[CD40$id %in% colnames(LD_no_dup)], CD40$id[CD40$id %in% colnames(LD_no_dup)]]
## Plot CD40 region
CD40_small <- CD40[CD40$id %in% colnames(LD_CD40),]
CD40_small_plot <-  CD40_small %>% dplyr::select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)
assoc_plot(CD40_small_plot, corr = LD_CD40)
MDD_small <- MDD[MDD$id %in% colnames(LD_MDD),]
assoc_plot((MDD_small %>% select(id, chr, pos, zscore) %>% rename(marker = id, z = zscore)), corr = LD_MDD)
MCP_small <- MCP[MCP$id %in% colnames(LD_MCP),]
assoc_plot((MCP_small %>% select(id, chr, pos, zscore) %>% rename(marker = id, z = zscore)), corr = LD_MCP)
## get MAF
CD40_small$MAF <- as.numeric(CD40_small$freq)
MDD_small$MAF <- as.numeric(MDD_small$freq)
MCP_small$MAF <- as.numeric(MCP_small$freq)
## make list
exposure_list <- list("pvalues" = CD40_small$pvalue, "beta" = CD40_small$beta, "varbeta" = CD40_small$varbeta, "N" = CD40_small$n, "type" = "quant", "MAF" = CD40_small$MAF, "LD" = as.matrix(LD_CD40), "snp" = CD40_small$id, "position" = CD40_small$pos)
outcome_MDD_list <- list("pvalues" = MDD_small$pvalue, "beta" = MDD_small$beta, "varbeta" = MDD_small$varbeta, "N" = MDD_small$n, "type" = "cc", "s" = mean(MDD_small$s), "MAF" = MDD_small$MAF, "LD" = as.matrix(LD_MDD), "snp" = MDD_small$id, "position" = MDD_small$pos, "sdY" = 1)
outcome_MCP_list <- list("pvalues" = MCP_small$pvalue, "beta" = MCP_small$beta, "varbeta" = MCP_small$varbeta, "N" = 440780, "type" = "quant", "MAF" = MCP_small$MAF, "LD" = as.matrix(LD_MCP), "snp" = MCP_small$id, "position" = MCP_small$pos)
## Check allele mismatch
condz_CD40 = kriging_rss(z = CD40_small$zscore, R = as.matrix(LD_CD40), n=mean(CD40_small$n))
condz_CD40$plot
## Remove SNPs with large difference between observed zscores and expected zscores (indication of LD panel mismatch)
remove_index <- which(abs(condz_CD40$conditional_dist$z_std_diff) > 2)
CD40_small_alligned <- CD40_small[-remove_index,]
LD_CD40_alligned <- LD_CD40[-remove_index, -remove_index]
## check again
condz_CD40_alligned = kriging_rss(z = CD40_small_alligned$zscore, R = as.matrix(LD_CD40_alligned), n=mean(CD40_small_alligned$n))
condz_CD40_alligned$plot
## Remove SNPs with large difference between observed zscores and expected zscores (indication of LD panel mismatch)
remove_index <- which(abs(condz_CD40$conditional_dist$z_std_diff) > 3)
CD40_small_alligned <- CD40_small[-remove_index,]
LD_CD40_alligned <- LD_CD40[-remove_index, -remove_index]
## check again
condz_CD40_alligned = kriging_rss(z = CD40_small_alligned$zscore, R = as.matrix(LD_CD40_alligned), n=mean(CD40_small_alligned$n))
condz_CD40_alligned$plot
condz_MDD = kriging_rss(z = MDD_small$zscore, R = as.matrix(LD_MDD), n=mean(MDD_small$n))
condz_MDD$plot
condz_MCP = kriging_rss(z = MCP_small$zscore, R = as.matrix(LD_MCP), n=440780)
condz_MCP$plot
## Remake list
exposure_alligned_list <- list("pvalues" = CD40_small_alligned$pvalue, "beta" = CD40_small_alligned$beta, "varbeta" = CD40_small_alligned$varbeta, "N" = CD40_small_alligned$n, "type" = "quant", "MAF" = CD40_small_alligned$MAF, "LD" = as.matrix(LD_CD40_alligned), "snp" = CD40_small_alligned$id, "position" = CD40_small_alligned$pos)
## Check alignment - should have positive skew
check_alignment(exposure_alligned_list)
check_alignment(outcome_MDD_list)
check_alignment(outcome_MCP_list)
## standard coloc (single causal variant)
my.res <- coloc.abf(dataset1=exposure_alligned_list, dataset2=outcome_MDD_list)
sensitivity(my.res,"H4 > 0.9")
my.res <- coloc.abf(dataset1=exposure_alligned_list, dataset2=outcome_MCP_list)
sensitivity(my.res,"H4 > 0.9")
## finemap
finemap.signals(exposure_alligned_list,method="cond")
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs1569723")
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs183193402")
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs184389928")
## finemap
finemap.signals(exposure_alligned_list,method="cond", maxhits = 10)
S_outcome_MDD_list <- runsusie(outcome_MDD_list, n = 3583863, max_causal = 100, max_iter = 1000)
summary(S_outcome_MDD_list)
S_outcome_MCP_list <- runsusie(outcome_MCP_list, n = 440780, max_causal = 100, max_iter = 1000, coverage=0.01)
summary(S_outcome_MCP_list)
S_exposure_list <- runsusie(exposure_alligned_list, n = 21758,  max_causal = 100, max_iter = 10000)
summary(S_exposure_list)
View(S_exposure_list)
## Plot each causal SNP
for (snp in (as.character(sapply(S_outcome_MCP_list[["sets"]]$cs,names)))){
assoc_plot((MCP_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_MCP, top.marker=snp)
}
as.character(sapply(S_outcome_MCP_list[["sets"]]$cs,names))
for (snp in (as.character(sapply(S_outcome_MDD_list[["sets"]]$cs,names)))){
assoc_plot((MDD_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_MDD, top.marker=snp)
}
as.character(sapply(S_outcome_MDD_list[["sets"]]$cs,names))
for (snp in (as.character(sapply(S_exposure_list[["sets"]]$cs,names)))){
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs184389928")
}
## Save susie output
save(S_outcome_MDD_list, file = "~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/S_outcome_MDD_list.Rdata")
save(S_outcome_MCP_list, file = "~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/S_outcome_MCP_list.Rdata")
save(S_exposure_list,file = "~/Desktop/PhD/projects/CP_MDD_inflammation_MR/resources/S_exposure_list.Rdata")
res_susie_CD40_MCP <- if(requireNamespace("susieR",quietly=TRUE)) {
susie_MCP_res=coloc.susie(S_outcome_MCP_list,exposure_alligned_list)
print(susie_MCP_res$summary)
}
for (i in 1:nrow(susie_MCP_res$summary)){
if(requireNamespace("susieR",quietly=TRUE)) {
sensitivity(susie_MCP_res,"H4 > 0.8",row=i,dataset1=outcome_MCP_list,dataset2=exposure_alligned_list)
}
}
## Colocalise CD40 and MDD
res_susie_CD40_MDD <- if(requireNamespace("susieR",quietly=TRUE)) {
susie_MDD_res=coloc.susie(S_outcome_MDD_list,S_exposure_list)
print(susie_MDD_res$summary)
}
## Sensitivity analysis
for (i in 1:nrow(susie_MDD_res$summary)){
if(requireNamespace("susieR",quietly=TRUE)) {
sensitivity(susie_MDD_res,"H4 > 0.8",row=i,dataset1=outcome_MDD_list,dataset2=exposure_list)
}
}
S_exposure_list
susie_MCP_res$summary$hit1
susie_MCP_res$summary$hit2
as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs1569723"))
as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs45546535"))
View(exposure_alligned_list)
View(CD40_small)
as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs187588460"))
as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs187588460"))
as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs1569723"))
LD_CD40["rs1569723"]
temp <-  LD_CD40["rs1569723"]
View(temp)
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs1569723")
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs3859613")
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs62215621")
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs435306")
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs378114")
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs11569348")
library(ggplotify)
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs3859613"))
plot <-    assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs3859613")
View(temp)
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs435306"))
rs11569348
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs11569348"))
temp <-  LD_CD40["rs11569348"]
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs117191103"))
rs6131010
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs6131010"))
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs1128536"))
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs6074060"))
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs77880402"))
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs6074012"))
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs6017741"))
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs4813005"))
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs6074046"))
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs73622651"))
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs4813002"))
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs4813003"))
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs6074032"))
temp <-  LD_CD40["rs6074032"]
View(temp)
temp <-  LD_CD40["rs6074032", "rs6074022"]
LD_CD40["rs6074032", "rs6074022"]
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs6074022"))
ggplotify::as.ggplot(assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs6074032"))
MDD_small <- MDD[MDD$id %in% colnames(LD_MDD),]
assoc_plot((MDD_small %>% select(id, chr, pos, zscore) %>% rename(marker = id, z = zscore)), corr = LD_MDD)
finemap.signals(outcome_MDD_list,method="cond", pthr = 0.1)
assoc_plot((MDD_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_MDD, top.marker="rs74174991")
S_outcome_MDD_list <- runsusie(outcome_MDD_list, n = 3583863, max_causal = 100, max_iter = 1000, r2.prune = 0.2)
summary(S_outcome_MDD_list)
S_exposure_list <- runsusie(exposure_alligned_list, n = 21758,  max_causal = 100, max_iter = 10000, r2.prune = 0.2)
summary(S_exposure_list)
S_outcome_MDD_list <- runsusie(outcome_MDD_list, n = 3583863, max_causal = 100, max_iter = 1000, r2.prune = 0.2, prior_variance=0.2^2)
summary(S_outcome_MDD_list)
S_outcome_MCP_list <- runsusie(outcome_MCP_list, n = 440780, max_causal = 100, max_iter = 1000, coverage=0.01, r2.prune = 0.2, prior_variance=0.15/sd(Y))^2)
S_outcome_MCP_list <- runsusie(outcome_MCP_list, n = 440780, max_causal = 100, max_iter = 1000, coverage=0.01, r2.prune = 0.2, prior_variance=(0.15/sd(Y))^2)
S_outcome_MDD_list <- runsusie(outcome_MDD_list, n = 3583863, max_causal = 100, max_iter = 1000, r2.prune = 0.2)
## Plot each causal SNP
for (snp in (as.character(sapply(S_outcome_MCP_list[["sets"]]$cs,names)))){
assoc_plot((MCP_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_MCP, top.marker=snp)
}
S_outcome_MCP_list <- runsusie(outcome_MCP_list, n = 440780, max_causal = 100, max_iter = 1000, coverage=0.001, r2.prune = 0.2)
summary(S_outcome_MCP_list)
## Plot each causal SNP
for (snp in (as.character(sapply(S_outcome_MCP_list[["sets"]]$cs,names)))){
assoc_plot((MCP_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_MCP, top.marker=snp)
}
as.character(sapply(S_outcome_MCP_list[["sets"]]$cs,names))
for (snp in (as.character(sapply(S_outcome_MDD_list[["sets"]]$cs,names)))){
assoc_plot((MDD_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_MDD, top.marker="rs74174991")
}
as.character(sapply(S_outcome_MDD_list[["sets"]]$cs,names))
for (snp in (as.character(sapply(S_outcome_MDD_list[["sets"]]$cs,names)))){
assoc_plot((MDD_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_MDD, top.marker=snp)
}
View(S_outcome_MDD_list)
S_outcome_MCP_list <- runsusie(outcome_MCP_list, n = 440780, max_causal = 100, max_iter = 1000, coverage=0.001, r2.prune = 0.2)
as.character(sapply(S_exposure_list[["sets"]]$cs,names))
## Colocalise CD40 and MCP
res_susie_CD40_MCP <- if(requireNamespace("susieR",quietly=TRUE)) {
susie_MCP_res=coloc.susie(S_outcome_MCP_list,exposure_alligned_list)
print(susie_MCP_res$summary)
}
exposure_alligned_list
exposure_alligned_list$n
exposure_alligned_list$N
for (i in 1:nrow(susie_MCP_res$summary)){
if(requireNamespace("susieR",quietly=TRUE)) {
sensitivity(susie_MCP_res,"H4 > 0.8",row=i,dataset1=outcome_MCP_list,dataset2=exposure_alligned_list)
}
}
sensitivity(susie_MCP_res,"H4 > 0.5",row=i,dataset1=outcome_MCP_list,dataset2=exposure_alligned_list)
for (i in 1:nrow(susie_MCP_res$summary)){
if(requireNamespace("susieR",quietly=TRUE)) {
sensitivity(susie_MCP_res,"H4 > 0.5",row=i,dataset1=outcome_MCP_list,dataset2=exposure_alligned_list)
}
}
susie_MCP_res$summary$hit2
## Colocalise CD40 and MCP
res_susie_CD40_MCP <- if(requireNamespace("susieR",quietly=TRUE)) {
susie_MCP_res=coloc.susie(S_outcome_MCP_list,S_exposure_list)
print(susie_MCP_res$summary)
}
susie_MCP_res$summary$hit2
View(CD40_small)
S_outcome_MCP_list
View(condz_MCP)
View(S_outcome_MCP_list)
susie_MCP_res$summary$hit2
View(S_exposure_list)
res_susie_CD40_MCP
assoc_plot((MDD_small %>% select(id, chr, pos, zscore) %>% rename(marker = id, z = zscore)), corr = LD_MDD, top.marker = "rs4578918")
res_susie_CD40_MCP
susie_MCP_res=coloc.susie(S_outcome_MCP_list,S_exposure_list)
rm(susie_MCP_res)
susie_MCP_res=coloc.susie(S_outcome_MCP_list,S_exposure_list)
## Colocalise CD40 and MCP
res_susie_CD40_MCP <- if(requireNamespace("susieR",quietly=TRUE)) {
susie_MCP_res=coloc.susie(S_outcome_MCP_list,S_exposure_list)
print(susie_MCP_res$summary)
}
for (i in 1:nrow(susie_MCP_res$summary)){
if(requireNamespace("susieR",quietly=TRUE)) {
sensitivity(susie_MCP_res,"H4 > 0.8",row=i,dataset1=outcome_MCP_list,dataset2=exposure_alligned_list)
}
}
## Colocalise CD40 and MDD
res_susie_CD40_MDD <- if(requireNamespace("susieR",quietly=TRUE)) {
susie_MDD_res=coloc.susie(S_outcome_MDD_list,S_exposure_list)
print(susie_MDD_res$summary)
}
## Sensitivity analysis
for (i in 1:nrow(susie_MDD_res$summary)){
if(requireNamespace("susieR",quietly=TRUE)) {
sensitivity(susie_MDD_res,"H4 > 0.8",row=i,dataset1=outcome_MDD_list,dataset2=exposure_list)
}
}
temp <- S_exposure_list[["pip"]][["rs2274676"]]
temp <- S_exposure_list[["pip"]]
S_exposure_list[["pip"]]
temp <- S_exposure_list[["pip"]]
temp <- as.data.frame(S_exposure_list[["pip"]])
View(temp)
remove_index\
remove_inde
remove_index
condz_CD40_alligned$plot
susie_MDD_res$summary$hit2
susie_MDD_res=coloc.susie(S_outcome_MDD_list,exposure_list)
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs45546535")
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs561506950")
View(CD40_small)
assoc_plot((CD40_small %>% select(id, chr, pos, zscore) %>% dplyr::rename(marker = id, z = zscore)), corr = LD_CD40, top.marker="rs45546535")
S_exposure_list[["pip"]]
temp <- as.data.frame(S_exposure_list[["pip"]])
View(temp)
S_exposure_list[["pip"]][["rs1569723"]]
summary(S_outcome_MCP_list, 0.1)
summary(S_outcome_MCP_list, 0.01)
summary(S_outcome_MCP_list, 0.001)
summary(S_outcome_MCP_list, coverage=0.1)
summary(S_outcome_MCP_list, coverage=0.01)
temp <- susie.res=coloc.susie(S_outcome_MCP_list,S_exposure_list)
temp <- coloc.susie(S_outcome_MCP_list,S_exposure_list)
temp = coloc.susie(S_outcome_MCP_list,S_exposure_list)
temp
View(temp)
temp[["summary"]]
S_exposure_list[["pip"]][["rs187588460"]]
